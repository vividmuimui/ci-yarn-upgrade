"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.toMarkdown = toMarkdown;
exports.toTextTable = toTextTable;

var _cliTable = require("@taichi/cli-table2");

var _cliTable2 = _interopRequireDefault(_cliTable);

var _package = require("../package.json");

var _package2 = _interopRequireDefault(_package);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Column {
    constructor(name, layout, render, simpleLayout, simpleRender) {
        this.name = name;
        this.layout = layout;
        this.render = render;
        this.simpleLayout = simpleLayout;
        this.simpleRender = simpleRender;
    }
}

function makeColumns(entries) {
    let columns = [];
    columns.push(new Column("Name", ":---- ", cw => {
        return cw.homepage ? `[${cw.name}](${cw.homepage})` : `\`${cw.name}\``;
    }, "left", cw => cw.name));
    columns.push(new Column("Updating", ":--------:", cw => {
        let u = cw.diffWantedURL();
        return u ? `[${cw.rangeWanted()}](${u})` : cw.rangeWanted();
    }, "center", cw => cw.rangeWanted()));
    columns.push(new Column("Latest", ":------:", cw => {
        let u = cw.diffLatestURL();
        return u ? `[${cw.latest}](${u})` : cw.latest;
    }, "center", cw => cw.latest));
    let depnames = ["dependencies", "devDependencies", "peerDependencies", "optionalDependencies", "bundledDependencies", "shadow"];
    depnames.forEach(n => {
        if (entries.find(v => v.packageType === n)) {
            let fn = cw => cw.packageType === n ? "*" : " ";
            columns.push(new Column(n, ":-:", fn, "center", fn));
        }
    });

    return columns;
}

function headers(columns) {
    let a = columns.map(col => col.name);
    return "| " + a.join(" | ") + " |";
}

function layouts(columns) {
    let a = columns.map(col => col.layout);
    return "|" + a.join("|") + "|";
}

function rows(columns, entries) {
    return entries.map(c => {
        let a = columns.map(col => col.render(c));
        return "| " + a.join(" | ") + " |";
    }).join("\n");
}

function toMarkdown(map) {
    let entries = Array.from(map.values());
    let columns = makeColumns(entries);
    return `## Updating Dependencies

${headers(columns)}
${layouts(columns)}
${rows(columns, entries)}

Powered by [${_package2.default.name}](${_package2.default.homepage})`;
}

function toTextTable(map) {
    let entries = Array.from(map.values());
    let columns = makeColumns(entries);
    let t = new _cliTable2.default({
        head: columns.map(col => col.name),
        chars: {
            "top": "=", "top-mid": "=", "top-left": "", "top-right": "",
            "bottom": "=", "bottom-mid": "=", "bottom-left": "", "bottom-right": "",
            "left": "", "left-mid": "", "mid": "-", "mid-mid": "-",
            "right": "", "right-mid": "", "middle": "|"
        },
        colAligns: columns.map(col => col.simpleLayout),
        style: {
            head: [],
            "padding-left": 1,
            "padding-right": 1
        }
    });

    entries.forEach(c => {
        t.push(columns.map(col => col.simpleRender(c)));
    });
    return t.toString();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wYXJlLmpzIl0sIm5hbWVzIjpbInRvTWFya2Rvd24iLCJ0b1RleHRUYWJsZSIsIkNvbHVtbiIsImNvbnN0cnVjdG9yIiwibmFtZSIsImxheW91dCIsInJlbmRlciIsInNpbXBsZUxheW91dCIsInNpbXBsZVJlbmRlciIsIm1ha2VDb2x1bW5zIiwiZW50cmllcyIsImNvbHVtbnMiLCJwdXNoIiwiY3ciLCJob21lcGFnZSIsInUiLCJkaWZmV2FudGVkVVJMIiwicmFuZ2VXYW50ZWQiLCJkaWZmTGF0ZXN0VVJMIiwibGF0ZXN0IiwiZGVwbmFtZXMiLCJmb3JFYWNoIiwibiIsImZpbmQiLCJ2IiwicGFja2FnZVR5cGUiLCJmbiIsImhlYWRlcnMiLCJhIiwibWFwIiwiY29sIiwiam9pbiIsImxheW91dHMiLCJyb3dzIiwiYyIsIkFycmF5IiwiZnJvbSIsInZhbHVlcyIsInBrZyIsInQiLCJUYWJsZSIsImhlYWQiLCJjaGFycyIsImNvbEFsaWducyIsInN0eWxlIiwidG9TdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7O1FBdURnQkEsVSxHQUFBQSxVO1FBWUFDLFcsR0FBQUEsVzs7QUFuRWhCOzs7O0FBRUE7Ozs7OztBQUVBLE1BQU1DLE1BQU4sQ0FBYTtBQUNUQyxnQkFBWUMsSUFBWixFQUFrQkMsTUFBbEIsRUFBMEJDLE1BQTFCLEVBQWtDQyxZQUFsQyxFQUFnREMsWUFBaEQsRUFBOEQ7QUFDMUQsYUFBS0osSUFBTCxHQUFZQSxJQUFaO0FBQ0EsYUFBS0MsTUFBTCxHQUFjQSxNQUFkO0FBQ0EsYUFBS0MsTUFBTCxHQUFjQSxNQUFkO0FBQ0EsYUFBS0MsWUFBTCxHQUFvQkEsWUFBcEI7QUFDQSxhQUFLQyxZQUFMLEdBQW9CQSxZQUFwQjtBQUNIO0FBUFE7O0FBVWIsU0FBU0MsV0FBVCxDQUFxQkMsT0FBckIsRUFBOEI7QUFDMUIsUUFBSUMsVUFBVSxFQUFkO0FBQ0FBLFlBQVFDLElBQVIsQ0FBYSxJQUFJVixNQUFKLENBQVcsTUFBWCxFQUFtQixR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YmxlIGZyb20gXCJAdGFpY2hpL2NsaS10YWJsZTJcIjtcblxuaW1wb3J0IHBrZyBmcm9tIFwiLi4vcGFja2FnZS5qc29uXCI7XG5cbmNsYXNzIENvbHVtbiB7XG4gICAgY29uc3RydWN0b3IobmFtZSwgbGF5b3V0LCByZW5kZXIsIHNpbXBsZUxheW91dCwgc2ltcGxlUmVuZGVyKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMubGF5b3V0ID0gbGF5b3V0O1xuICAgICAgICB0aGlzLnJlbmRlciA9IHJlbmRlcjtcbiAgICAgICAgdGhpcy5zaW1wbGVMYXlvdXQgPSBzaW1wbGVMYXlvdXQ7XG4gICAgICAgIHRoaXMuc2ltcGxlUmVuZGVyID0gc2ltcGxlUmVuZGVyO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbWFrZUNvbHVtbnMoZW50cmllcykge1xuICAgIGxldCBjb2x1bW5zID0gW107XG4gICAgY29sdW1ucy5wdXNoKG5ldyBDb2x1bW4oXCJOYW1lXCIsIFwiOi0tLS0gXCIsIGN3ID0+IHtcbiAgICAgICAgcmV0dXJuIGN3LmhvbWVwYWdlID8gYFske2N3Lm5hbWV9XSgke2N3LmhvbWVwYWdlfSlgIDogYFxcYCR7Y3cubmFtZX1cXGBgO1xuICAgIH0sIFwibGVmdFwiLCBjdyA9PiBjdy5uYW1lKSk7XG4gICAgY29sdW1ucy5wdXNoKG5ldyBDb2x1bW4oXCJVcGRhdGluZ1wiLCBcIjotLS0tLS0tLTpcIiwgY3cgPT4ge1xuICAgICAgICBsZXQgdSA9IGN3LmRpZmZXYW50ZWRVUkwoKTtcbiAgICAgICAgcmV0dXJuIHUgPyBgWyR7Y3cucmFuZ2VXYW50ZWQoKX1dKCR7dX0pYCA6IGN3LnJhbmdlV2FudGVkKCk7XG4gICAgfSwgXCJjZW50ZXJcIiwgY3cgPT4gY3cucmFuZ2VXYW50ZWQoKSkpO1xuICAgIGNvbHVtbnMucHVzaChuZXcgQ29sdW1uKFwiTGF0ZXN0XCIsIFwiOi0tLS0tLTpcIiwgY3cgPT4ge1xuICAgICAgICBsZXQgdSA9IGN3LmRpZmZMYXRlc3RVUkwoKTtcbiAgICAgICAgcmV0dXJuIHUgPyBgWyR7Y3cubGF0ZXN0fV0oJHt1fSlgIDogY3cubGF0ZXN0O1xuICAgIH0sIFwiY2VudGVyXCIsIGN3ID0+IGN3LmxhdGVzdCkpO1xuICAgIGxldCBkZXBuYW1lcyA9IFtcImRlcGVuZGVuY2llc1wiLCBcImRldkRlcGVuZGVuY2llc1wiLCBcInBlZXJEZXBlbmRlbmNpZXNcIiwgXCJvcHRpb25hbERlcGVuZGVuY2llc1wiLCBcImJ1bmRsZWREZXBlbmRlbmNpZXNcIiwgXCJzaGFkb3dcIl07XG4gICAgZGVwbmFtZXMuZm9yRWFjaChuID0+IHtcbiAgICAgICAgaWYgKGVudHJpZXMuZmluZCh2ID0+IHYucGFja2FnZVR5cGUgPT09IG4pKSB7XG4gICAgICAgICAgICBsZXQgZm4gPSBjdyA9PiBjdy5wYWNrYWdlVHlwZSA9PT0gbiA/IFwiKlwiIDogXCIgXCI7XG4gICAgICAgICAgICBjb2x1bW5zLnB1c2gobmV3IENvbHVtbihuLCBcIjotOlwiLCBmbiwgXCJjZW50ZXJcIiwgZm4pKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNvbHVtbnM7XG59XG5cbmZ1bmN0aW9uIGhlYWRlcnMoY29sdW1ucykge1xuICAgIGxldCBhID0gY29sdW1ucy5tYXAoY29sID0+IGNvbC5uYW1lKTtcbiAgICByZXR1cm4gXCJ8IFwiICsgYS5qb2luKFwiIHwgXCIpICsgXCIgfFwiO1xufVxuXG5mdW5jdGlvbiBsYXlvdXRzKGNvbHVtbnMpIHtcbiAgICBsZXQgYSA9IGNvbHVtbnMubWFwKGNvbCA9PiBjb2wubGF5b3V0KTtcbiAgICByZXR1cm4gXCJ8XCIgKyBhLmpvaW4oXCJ8XCIpICsgXCJ8XCI7XG59XG5cbmZ1bmN0aW9uIHJvd3MoY29sdW1ucywgZW50cmllcykge1xuICAgIHJldHVybiBlbnRyaWVzLm1hcChjID0+IHtcbiAgICAgICAgbGV0IGEgPSBjb2x1bW5zLm1hcChjb2wgPT4gY29sLnJlbmRlcihjKSk7XG4gICAgICAgIHJldHVybiBcInwgXCIgKyBhLmpvaW4oXCIgfCBcIikgKyBcIiB8XCI7XG4gICAgfSkuam9pbihcIlxcblwiKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRvTWFya2Rvd24obWFwKSB7XG4gICAgbGV0IGVudHJpZXMgPSBBcnJheS5mcm9tKG1hcC52YWx1ZXMoKSk7XG4gICAgbGV0IGNvbHVtbnMgPSBtYWtlQ29sdW1ucyhlbnRyaWVzKTtcbiAgICByZXR1cm4gYCMjIFVwZGF0aW5nIERlcGVuZGVuY2llc1xuXG4ke2hlYWRlcnMoY29sdW1ucyl9XG4ke2xheW91dHMoY29sdW1ucyl9XG4ke3Jvd3MoY29sdW1ucywgZW50cmllcyl9XG5cblBvd2VyZWQgYnkgWyR7cGtnLm5hbWV9XSgke3BrZy5ob21lcGFnZX0pYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRvVGV4dFRhYmxlKG1hcCkge1xuICAgIGxldCBlbnRyaWVzID0gQXJyYXkuZnJvbShtYXAudmFsdWVzKCkpO1xuICAgIGxldCBjb2x1bW5zID0gbWFrZUNvbHVtbnMoZW50cmllcyk7XG4gICAgbGV0IHQgPSBuZXcgVGFibGUoe1xuICAgICAgICBoZWFkOiBjb2x1bW5zLm1hcChjb2wgPT4gY29sLm5hbWUpLFxuICAgICAgICBjaGFyczoge1xuICAgICAgICAgICAgXCJ0b3BcIjogXCI9XCIsIFwidG9wLW1pZFwiOiBcIj1cIiwgXCJ0b3AtbGVmdFwiOiBcIlwiLCBcInRvcC1yaWdodFwiOiBcIlwiXG4gICAgICAgICAgICAsIFwiYm90dG9tXCI6IFwiPVwiLCBcImJvdHRvbS1taWRcIjogXCI9XCIsIFwiYm90dG9tLWxlZnRcIjogXCJcIiwgXCJib3R0b20tcmlnaHRcIjogXCJcIlxuICAgICAgICAgICAgLCBcImxlZnRcIjogXCJcIiwgXCJsZWZ0LW1pZFwiOiBcIlwiLCBcIm1pZFwiOiBcIi1cIiwgXCJtaWQtbWlkXCI6IFwiLVwiXG4gICAgICAgICAgICAsIFwicmlnaHRcIjogXCJcIiwgXCJyaWdodC1taWRcIjogXCJcIiwgXCJtaWRkbGVcIjogXCJ8XCJcbiAgICAgICAgfSxcbiAgICAgICAgY29sQWxpZ25zOiBjb2x1bW5zLm1hcChjb2wgPT4gY29sLnNpbXBsZUxheW91dCksXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICBoZWFkOiBbXSxcbiAgICAgICAgICAgIFwicGFkZGluZy1sZWZ0XCI6IDEsXG4gICAgICAgICAgICBcInBhZGRpbmctcmlnaHRcIjogMVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBlbnRyaWVzLmZvckVhY2goYyA9PiB7XG4gICAgICAgIHQucHVzaChjb2x1bW5zLm1hcChjb2wgPT4gY29sLnNpbXBsZVJlbmRlcihjKSkpO1xuICAgIH0pO1xuICAgIHJldHVybiB0LnRvU3RyaW5nKCk7XG59XG4iXX0=